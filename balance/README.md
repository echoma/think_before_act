# balance项目动手前的思考

## 项目背景

### 背景

* 交易后台的日常开发中经常需要测试交易行为，但是缺少好用的命令行交易工具，目前在命令行只能通过telnet来搞，效率很低。
* 跟交易所进行演习过程中，由于是运营环境，但是为了不能将演习过程展示给前段，没办法使用牛牛，所以也缺少合适的命令行交易工具。
* 将来第三方接口或者FIX-API放出后，有一套稳定的命令行文本UI的交易工具也是很不错的，客户可以在linux云上快速搭建自己的环境。

### 背景分析

* 鉴于自己的兴趣，而且项目也具有一定的实用性，决定业余时间搞一搞这个东西。
* 命令行交易工具的界面和后台交易操作应该是独立的，界面可以接入到各种不同的后台接口（开发环境、交易所演习环境、开放API或任一第三方），只要界面定义一套跟后台交互的标准即可。
* 命令行交易工具的界面肯定要是`TUI，text ui`的，而不是那种很low的交互式提示符形式。根据之前`zk_cli`的技术调研积累，node下面的[blessed](https://github.com/chjj/blessed)是效果最好、开发最省力的TUI方案，还有些不错的扩展界面组件[blessed-contrib](https://www.npmjs.com/package/blessed-contrib)。
* 界面的最舒服的要求就是要支持自定义布局。布局肯定要能保存和加载，这样很方便使用，也方便不同的用户交流。

### balance

* 这里先在`think_before_act`里把相关需求和技术（尤其是TUI）做下研究分析。
* 在github上只能开源界面部分了，交易日常测试和演习的后端接口肯定是公司内部的东西了。
* 界面的项目取名为`balance`，纪念下富途的前身`百仁思`，这是一个使用自己研发的交易工具交易港股的基金公司。

## 需求

### 布局

* 接触过不少布局框架，当然HTML5自带的flex框架最好用了。自己搞个简单的应该不难，用js开发也是相当快的。
* 布局 = 在什么`位置`摆放了`何种UI组件`的一个`实例`，该实例的`ID`、`Z轴位置`、`自定义外观`（比如长宽、颜色）、最新的`表单数值`。
* 布局可以被保存、加载，用json存放好了，比较流行，数据结构也丰富。

### UI组件

* UI组件是可以显示在界面上的独立窗口，他可以独立完成某种功能（下单功能、查看账户资金功能）。
* UI组件是一个类，它可以被实例化。作为类，他一定要有名字，典型的名字就是java式的`域名/路径/类名`的方式来做唯一标志，比如`io.github.echoma/balance/order_input`表示balance自带的下单组件。
* UI组件的一些界面参数、逻辑可以作为配置被使用者自定义，从而形成新的UI组件。这种使用类似继承机制得到的组件，应该被考虑支持。

### 风险考量

* 有些字段随便乱填是有风险的，尤其是在生产环境演习过程中在客户账户上进行操作是严禁的，因此所有组件需要可以限制账户列表。因此所有组件里，不能出现可以随意填写的账号字段。
* 订单金额的范围也要加以限制，否则也有可能因为bug导致大的风险。

## 技术调研

* blessed对弹性布局的支持只能做到grid方式，做不到flex-box方式。
* blessed的文档写的一般般，还好内容不多，摸索一下也能搞定。
